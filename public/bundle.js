(()=>{let e,t,o,n,c,i,a,s,l,r;switch(localStorage.getItem("loginId")?(a=!0,s=localStorage.getItem("loginId")):a=!1,localStorage.getItem("voteId")&&(l=localStorage.getItem("voteId")),localStorage.getItem("topicId")&&(r=localStorage.getItem("topicId")),location.pathname){case"/public/":e=!0;break;case"/public/pages/admin.html":t=!0;break;case"/public/pages/topic.html":o=!0;break;case"/public/pages/vote-search.html":n=!0;break;case"/public/pages/vote.html":c=!0;break;case"/public/pages/answer.html":i=!0}async function d(){const e=document.querySelector(".admin-title");loginUser=await p(s),e.innerHTML=loginUser}function u(e){return new Date(e).toISOString()}async function p(e){this.id=e;try{const t=await fetch(`http://localhost:3000/users/${e}`);if(t.ok)return username=await t.json(),username=username.username,username;console.log(t.status)}catch(e){console.log(e)}}async function m(e){try{const t=await fetch(`http://localhost:3000/topic/${e}`);if(t.ok)return await t.json();console.error(t.status)}catch(e){console.log(e),console.log("please reload to fetch data again")}}c||i||localStorage.removeItem("voteId"),o||localStorage.removeItem("topicId"),document.addEventListener("DOMContentLoaded",(()=>{if(t){const e=document.querySelector(".admin-title"),t=document.querySelector(".logout-wrap");if(a){d();const e=document.querySelector(".login-section");e.classList.remove("flex-v"),e.classList.add("invisible"),t.classList.remove("invisible"),t.onclick=()=>{localStorage.removeItem("loginId"),location.reload()}}else e.innerHTML="User Login";const o=document.getElementById("username"),n=document.getElementById("password");document.querySelector(".login").onclick=()=>{!async function(e,t){this.username=e,this.password=t,console.log(`username: ${this.username}, password: ${this.password}`);try{const e=await fetch("http://localhost:3000/users/checklogin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.username,password:this.password})});if(e.ok){const t=await e.json();"invalid"===t.error?console.log("Invalid username or password."):(console.log("Login successful:",t),s=t.id,localStorage.setItem("loginId",s),d(),location.reload())}else console.error("Error fetching data. Status:",e.status)}catch(e){console.error(e)}}(o.value,n.value)}}if(e){const e=document.querySelector(".recent"),t=document.querySelector(".public"),o=document.querySelector(".own");(async()=>{document.querySelector(".create-topic").onclick=()=>{location.href="/public/pages/topic.html"},s&&((await async function(){try{const e=await fetch(`http://localhost:3000/topic/recent/${s}`);if(e.ok)return await e.json();console.error(e.status)}catch(e){console.log(e),console.log("please reload to fetch data again")}}()).sort(((e,t)=>{const o=u(e.submit_time);return u(t.submit_time).localeCompare(o)})).forEach((async t=>{const o=await m(t.topic_id),n=document.createElement("div");n.className="topics",n.id=t.topic_id;const c=document.createElement("topic-title"),i=document.createElement("p");i.id="topic-title",i.textContent=o.name;const a=document.createElement("img");a.className="profile-picture",a.src="img/2.png",c.appendChild(i),c.appendChild(a);const s=document.createElement("p");s.id="topic-description",s.textContent=t.answer,n.appendChild(c),n.appendChild(s),e.appendChild(n)})),setTimeout((()=>{document.querySelectorAll(".topics").forEach((e=>{e.onclick=()=>{console.log(e.id),localStorage.setItem("voteId",e.id),location.href="/public/pages/answer.html"}}))}),500)),(await async function(){try{const e=await fetch("http://localhost:3000/topic");if(e.ok)return await e.json();console.error(e.status)}catch(e){console.log(e),console.log("please reload to fetch data again")}}()).sort(((e,t)=>{const o=u(e.create_date);return u(t.create_date).localeCompare(o)})).forEach((e=>{const o=document.createElement("div");o.className="topics",o.id=e.id;const n=document.createElement("topic-title"),c=document.createElement("p");c.id="topic-title",c.textContent=e.name;const i=document.createElement("img");i.className="profile-picture",i.src="img/2.png",n.appendChild(c),n.appendChild(i);const a=document.createElement("p");a.id="topic-description",a.textContent=e.description,o.appendChild(n),o.appendChild(a),t.appendChild(o)})),document.querySelectorAll(".topics").forEach((e=>{e.onclick=()=>{localStorage.setItem("voteId",e.id),location.href="/public/pages/vote.html"}}));const n=(await async function(){try{const e=await fetch(`http://localhost:3000/topic/all/${s}`);if(e.ok)return await e.json();console.error(e.status),alert(e.status)}catch(e){console.log(e),console.log("please reload to fetch data again")}}()).sort(((e,t)=>{const o=u(e.create_date);return u(t.create_date).localeCompare(o)}));topicAmount=n.length,n.forEach((e=>{const t=document.createElement("div");t.classList.add("topics");const n=document.createElement("topic-title"),c=document.createElement("p");c.textContent=`${e.name}`;const i=document.createElement("img");i.classList.add("profile-picture"),i.src="img/1.png",n.appendChild(c),n.appendChild(i);const a=document.createElement("div");a.classList.add("flex-h","justify-sb","width-100");const s=document.createElement("p");s.textContent="Vote : 86",a.appendChild(s);const l=document.createElement("div");l.classList.add("topic-card","copy-id","align-items-center","justify-sb","flex-h"),l.id=e.id;const r=document.createElement("p");r.textContent="Copy ID";const d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttribute("width","16"),d.setAttribute("height","16"),d.setAttribute("viewBox","0 0 16 16"),d.setAttribute("fill","none");const u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d","M10.2067 5.79347C12.0737 7.6625 12.0481 10.659 10.2179 12.4994C10.2145 12.5031 10.2104 12.5072 10.2067 12.511L8.10666 14.611C6.25447 16.4631 3.24107 16.4629 1.38917 14.611C-0.463015 12.7591 -0.463015 9.74534 1.38917 7.89347L2.54873 6.73391C2.85623 6.42641 3.38579 6.63078 3.40166 7.06535C3.42191 7.61916 3.52123 8.17556 3.70448 8.71287C3.76654 8.89481 3.7222 9.09606 3.58626 9.232L3.17729 9.64097C2.30148 10.5168 2.27401 11.9428 3.1412 12.8272C4.01694 13.7203 5.45638 13.7256 6.33885 12.8431L8.43884 10.7435C9.31981 9.8625 9.31612 8.43856 8.43884 7.56128C8.32319 7.44585 8.20669 7.35616 8.11569 7.2935C8.05131 7.24929 7.99816 7.19065 7.96046 7.12226C7.92277 7.05386 7.90158 6.9776 7.89859 6.89957C7.88622 6.56935 8.00322 6.22907 8.26416 5.96813L8.92209 5.31016C9.09462 5.13763 9.36528 5.11644 9.56534 5.25607C9.79445 5.41605 10.0091 5.59588 10.2067 5.79347ZM14.6109 1.38904C12.759 -0.46289 9.74556 -0.46314 7.89338 1.38904L5.79338 3.48904C5.78963 3.49279 5.78557 3.49685 5.78213 3.5006C3.95194 5.34097 3.92629 8.3375 5.79338 10.2065C5.99097 10.4041 6.20555 10.5839 6.43466 10.7439C6.63472 10.8835 6.90541 10.8623 7.07791 10.6898L7.73584 10.0318C7.99678 9.7709 8.11378 9.43062 8.10141 9.1004C8.09841 9.02237 8.07723 8.94611 8.03954 8.87771C8.00184 8.80932 7.94869 8.75068 7.88431 8.70647C7.79331 8.64381 7.67681 8.55412 7.56116 8.43869C6.68388 7.56141 6.68019 6.13747 7.56116 5.25651L9.66115 3.15682C10.5436 2.27435 11.983 2.27967 12.8588 3.17276C13.726 4.05713 13.6986 5.48319 12.8227 6.359L12.4137 6.76797C12.2778 6.90391 12.2335 7.10516 12.2955 7.2871C12.4788 7.82441 12.5781 8.38081 12.5983 8.93462C12.6142 9.36918 13.1438 9.57356 13.4513 9.26606L14.6108 8.1065C16.463 6.25466 16.463 3.24092 14.6109 1.38904Z"),u.setAttribute("fill","#F800C1"),d.appendChild(u),l.appendChild(r),l.appendChild(d),a.appendChild(l),t.appendChild(n),t.appendChild(a),o.appendChild(t)})),document.querySelectorAll(".topics").forEach((e=>{const t=e.querySelector(".copy-id");t&&(t.onclick=e=>{var o;e.stopPropagation(),o=t.id,navigator.clipboard.writeText(o),console.log("Content copied to clipboard")},e.onclick=()=>{localStorage.setItem("topicId",t.id),location.href="/public/pages/topic.html"})}))})()}if(e||i){const e=document.querySelector(".option-wrapper"),t=Array.from(e.children),o=document.querySelector(".recent"),n=document.querySelector(".public"),c=document.querySelector(".own"),i=document.querySelector(".answers"),a=document.querySelector(".rank"),s=document.querySelector("#answer-title");e.addEventListener("click",(e=>{const l=e.target;function r(e,t,o){e.classList.add("invisible"),t.classList.add("invisible"),o.classList.remove("invisible"),o.classList.add("inline-flex")}switch("LI"===l.tagName&&(t.forEach((e=>e.classList.remove("active-option"))),l.classList.add("active-option")),l.innerHTML){case"Recent":r(n,c,o);break;case"Public Vote":r(o,c,n);break;case"Your Topic":r(n,o,c);break;case"List":i.classList.remove("invisible"),i.classList.add("grid"),a.classList.add("invisible"),a.classList.remove("grid"),s.innerHTML="Answer List";break;case"Rank":a.classList.remove("invisible"),a.classList.add("grid"),i.classList.remove("grid"),i.classList.add("invisible"),s.innerHTML="Answer Rank"}}))}if(i&&(async()=>{const e=document.querySelector("#topic-title"),t=await m(l);e.innerHTML=t.name;const o=await async function(){try{const e=await fetch(`http://localhost:3000/vote/all/${l}`);if(e.ok)return await e.json();console.error(e.status)}catch(e){console.log(e),console.log("please reload to fetch data again")}}();console.log(o.length),o.forEach((e=>{const t=document.createElement("li"),o=document.createElement("div");o.className="username width-100",o.textContent=`${e.nickname}`;const n=document.createElement("div");n.className="answer",n.textContent=`${e.answer}`,t.appendChild(o),t.appendChild(n),document.querySelector(".answers").appendChild(t)}));const n={};let c=0;o.forEach((e=>{const t=e.answer;n[t]=(n[t]||0)+1,c++}));let i=0;for(const e in n)n[e]>i&&(mostCommonAnswer=e,i=n[e]);const a=Object.keys(n).sort(((e,t)=>n[t]-n[e])).slice(0,5);!function(){for(let e=0;e<5;e++)a[e]||(a[e]="",n[""]=0)}();const s=a.map((e=>({answer:e,count:n[e],allRetrieveVote:o.filter((t=>t.answer===e))}))),r=s.map((e=>e.count/c)),d=document.getElementById("no1-content"),u=document.getElementById("no2-content"),p=document.getElementById("no3-content"),h=document.getElementById("no4-content"),g=document.getElementById("no5-content"),y=document.getElementById("no1"),v=document.getElementById("no2"),f=document.getElementById("no3"),w=document.getElementById("no4"),C=document.getElementById("no5");for(let e=0;e<5;e++)0===r[e]&&(r[e]=-.04);y.style.width=100*r[0]+4+"%",v.style.width=100*r[1]+4+"%",f.style.width=100*r[2]+4+"%",w.style.width=100*r[3]+4+"%",C.style.width=100*r[4]+4+"%",d.setAttribute("title",s[0].answer),u.setAttribute("title",s[1].answer),p.setAttribute("title",s[2].answer),h.setAttribute("title",s[3].answer),g.setAttribute("title",s[4].answer),d.innerHTML=s[0].answer,u.innerHTML=s[1].answer,p.innerHTML=s[2].answer,h.innerHTML=s[3].answer,g.innerHTML=s[4].answer,y.innerHTML=s[0].count,v.innerHTML=s[1].count,f.innerHTML=s[2].count,w.innerHTML=s[3].count,C.innerHTML=s[4].count})(),c&&l){const e=document.querySelector("#username"),t=document.querySelector("#answer");(async()=>{const t=document.querySelector("#topic-title");topicDTO=await m(l),t.innerHTML=topicDTO.name,s&&(loginUser=await p(s),e.value=loginUser)})(),document.querySelector("#submit-btn").onclick=()=>{""!==t.value&&""!==e.value&&async function(e,t,o){this.nickname=e,this.answer=t,this.voteId=o;try{const e=await fetch("http://localhost:3000/vote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nickname:this.nickname,answer:this.answer,topic_id:this.voteId})});e.ok?(console.log("Success"),location.href="/public/pages/answer.html"):console.log(e.status)}catch(e){console.log(e),error=!0}}(e.value,t.value,l)}}if(n||c||i){if(document.querySelector("#search-btn").onclick=()=>{!async function(e){this.topicID=e;try{const e=await fetch("http://localhost:3000/topic/checkID",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:this.topicID})});e.ok?(await e.json(),localStorage.setItem("voteId",this.topicID),location.href="/public/pages/vote.html"):console.error(e.status)}catch(e){console.log(e),console.log("please reload to fetch data again")}}(document.querySelector("#search-vote").value)},n)return;document.querySelector("#search-vote").placeholder=l}o&&(async()=>{const e=document.getElementById("topic-title"),t=document.getElementById("topic-name"),o=document.getElementById("topic-description"),n=document.querySelector(".public-btn"),c=document.querySelector(".private-btn"),i=document.getElementById("save-create-btn");if(r){e.innerHTML="Editing Topic",i.innerHTML="Save";const a=await m(r);console.log(a),t.value=a.name,o.value=a.description,console.log(a.public_or_private),"private"===a.public_or_private&&(console.log(!0),n.id="",c.id="active"),n.onclick=()=>{""===n.id&&(n.id="active",c.id="")},c.onclick=()=>{""===c.id&&(c.id="active",n.id="")},i.onclick=()=>{""!==t.value&&("active"===n.id&&(active="public"),"active"===c.id&&(active="private"),async function(e,t,o,n,c){this.name=e,this.description=t,this.active=o,this.loginId=n,this.topicId=c;try{const e=await fetch(`http://localhost:3000/topic/update/${this.topicId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.name,description:this.description,public_or_private:this.active,create_by:this.loginId})});if(e.ok){const t=await e.json();console.log(t),"ECONNREFUSED"===t.code?console.log("server database is currently offline"):location.href="/public"}else console.error(e.status)}catch(e){console.log(e)}}(t.value,o.value,active,s,r))}}else e.innerHTML="Creating Topic",n.onclick=()=>{""===n.id&&(n.id="active",c.id="")},c.onclick=()=>{""===c.id&&(c.id="active",n.id="")},i.onclick=()=>{""!==t.value&&("active"===n.id&&(active="public"),"active"===c.id&&(active="private"),async function(e,t,o,n){this.name=e,this.description=t,this.active=o,this.loginId=n;try{const e=await fetch("http://localhost:3000/topic/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.name,description:this.description,public_or_private:this.active,create_by:this.loginId})});if(e.ok){const t=await e.json();console.log(t),"ECONNREFUSED"===t.code?console.log("server database is currently offline"):location.href="/public"}else console.error(e.status)}catch(e){console.log(e)}}(t.value,o.value,active,s))}})()}))})();